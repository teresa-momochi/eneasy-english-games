<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="google" content="notranslate">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Swap to Questions! (5 Items / Messy Bank)</title>
  <style>
    :root{
      --bg1:#ffd6ea;
      --bg2:#fff3fa;
      --card:#ffffff;
      --shadow: 0 16px 34px rgba(0,0,0,.14);
      --tileShadow: 0 12px 20px rgba(0,0,0,.14);
      --border: rgba(0,0,0,.10);
      --mint:#d7fff1;
      --sky:#dff1ff;
      --lemon:#fff3a6;
      --lav:#efe4ff;
      --pink:#ffd8ef;
      --ok: rgba(46, 204, 113, .35);
      --warn: rgba(231, 76, 60, .22);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: radial-gradient(circle at top, var(--bg2), var(--bg1));
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
    }

    .app{
      width:min(1020px, 100%);
      background: rgba(255,255,255,0.92);
      border-radius: 24px;
      box-shadow: var(--shadow);
      padding: 14px;
    }

    .top{
      display:flex; gap:10px; flex-wrap:wrap;
      justify-content:space-between; align-items:center;
      margin-bottom: 10px;
    }
    h1{ margin:0; font-size:20px; }
    .hint{ margin-top:4px; font-size:14px; opacity:.85; }

    .controls{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    button{
      border:0;
      padding:10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 900;
      background:#111;
      color:#fff;
      box-shadow: 0 8px 16px rgba(0,0,0,.12);
    }
    button.secondary{
      background:#fff;
      color:#111;
      border:2px solid #111;
      box-shadow:none;
    }
    button:disabled{ opacity:.5; cursor:not-allowed; }

    .badges{
      display:flex; gap:10px; flex-wrap:wrap;
      margin: 6px 0 12px;
    }
    .badge{
      background: var(--lemon);
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 1000;
      border: 2px solid rgba(0,0,0,.06);
    }

    .block{
      background: var(--card);
      border-radius: 18px;
      border: 2px solid rgba(0,0,0,.06);
      padding: 12px;
      margin-bottom: 12px;
    }

    .blockTitle{
      font-weight: 1000;
      margin-bottom: 8px;
      display:flex; align-items:center; gap:8px;
    }
    .chip{
      font-size: 12px;
      font-weight: 1000;
      padding: 5px 10px;
      border-radius: 999px;
      background: var(--lav);
      border: 2px solid rgba(0,0,0,.06);
    }

    .sentence{
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
      align-items:center;
      justify-content:center;
      min-height: 74px;
      padding: 10px;
      border-radius: 16px;
      background: linear-gradient(180deg, #ffffff, #fafafa);
      border: 2px dashed rgba(0,0,0,.12);
    }

    /* å¥é¦–è‡ªå‹•å¤§å¯«ï¼šStatement & Question */
    #statementRow .slot:first-child .tileText,
    #questionRow  .slot:first-child .tileText{
      text-transform: capitalize;
    }

    .slot{
      width: 160px;
      min-height: 60px;
      border-radius: 18px;
      background:#fff;
      border: 2px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 6px;
      position: relative;
    }

    /* punctuation slot smaller */
    .slot.punct{
      width: 80px;
      min-height: 60px;
      padding: 4px;
      background: #f4f6f8;
      border-style: dashed;
      opacity: .95;
    }
    .slot.punct .tile{
      min-width: unset;
      padding: 10px 8px;
      font-size: 22px;
    }

    /* keyboard-like inset */
    .slot::after{
      content:"";
      position:absolute;
      inset: 6px;
      border-radius: 14px;
      background: rgba(0,0,0,.03);
      z-index:0;
    }
    .slot > *{ position: relative; z-index:1; }

    .tile{
      min-width: 150px;
      padding: 14px 12px;
      border-radius: 18px;
      font-weight: 1000;
      text-align:center;
      cursor: grab;
      user-select:none;
      -webkit-tap-highlight-color: transparent;

      background: linear-gradient(180deg, #ffffff, #f7f7f7);
      border: 2px solid rgba(0,0,0,.10);
      box-shadow: var(--tileShadow);
      transform: translateY(0);
      transition: transform .08s ease;
    }
    .tile:active{
      cursor: grabbing;
      transform: translateY(2px);
      box-shadow: 0 6px 12px rgba(0,0,0,.12);
    }
    .tile[data-color="mint"]{ background: linear-gradient(180deg, #ffffff, var(--mint)); }
    .tile[data-color="pink"]{ background: linear-gradient(180deg, #ffffff, var(--pink)); }
    .tile[data-color="lav"]{  background: linear-gradient(180deg, #ffffff, var(--lav)); }
    .tile[data-color="sky"]{  background: linear-gradient(180deg, #ffffff, var(--sky)); }
    .tile[data-color="lemon"]{background: linear-gradient(180deg, #ffffff, var(--lemon)); }

    .toast{
      margin-top: 8px;
      font-weight: 1000;
      min-height: 28px;
      text-align:center;
    }

    /* Answer sticky bottom */
    .answerSticky{
      position: sticky;
      bottom: 10px;
      z-index: 5;
      box-shadow: 0 10px 24px rgba(0,0,0,.10);
    }

    /* ======= Messy Word Bank (irregular) ======= */
    .bankArea{
      position: relative;
      min-height: 160px;
      border-radius: 16px;
      border: 2px solid rgba(0,0,0,.06);
      background: linear-gradient(180deg, var(--sky), #ffffff);
      overflow: hidden;
    }
    .bankArea .tile{
      position: absolute; /* äº‚ç‘ */
      min-width: 140px;
    }

    /* feedback effects */
    .okGlow{ outline: 6px solid var(--ok); animation: pop .25s ease-out; }
    .warnGlow{ outline: 6px solid var(--warn); animation: shake .35s ease-in-out; }

    @keyframes shake{
      0%{ transform: translateX(0); }
      25%{ transform: translateX(-6px); }
      50%{ transform: translateX(6px); }
      75%{ transform: translateX(-4px); }
      100%{ transform: translateX(0); }
    }
    @keyframes pop{
      0%{ transform: scale(1); }
      60%{ transform: scale(1.04); }
      100%{ transform: scale(1); }
    }

    @media (max-width: 760px){
      .slot{ width: 46%; min-height: 64px; }
      .slot.punct{ width: 30%; }
      .tile{ min-width: 44%; padding: 16px 12px; }
      .sentence{ justify-content: space-between; }
      .answerSticky{ bottom: 6px; }
      .bankArea{ min-height: 210px; }
      .bankArea .tile{ min-width: 44%; }
    }
  </style>
</head>

<body>
<div class="app">
  <div class="top">
    <div>
      <h1>Swap to Questions! âœ…ï¼ˆäº”é¡Œå›ºå®šãƒ»äº‚ç‘æ€è€ƒç‰ˆï¼‰</h1>
      <div class="hint">æŠŠå­—å¡æ‹–åˆ°æœ€ä¸‹é¢çµ„æˆç–‘å•å¥ã€‚å¥é¦–è‡ªå‹•å¤§å¯«ã€å¥å°¾è¦ <b>?</b>ã€‚æ¯é¡Œéƒ½æœƒé‡æ–°æ´—ç‰Œäº‚ç‘ã€‚</div>
    </div>
    <div class="controls">
      <button id="startBtn">Start (Enable Voice)</button>
      <button id="repeatBtn" class="secondary" disabled>Repeat</button>
      <button id="resetBtn" class="secondary">Restart</button>
    </div>
  </div>

  <div class="badges">
    <div class="badge">Item: <span id="itemNum">1</span>/5</div>
    <div class="badge">Score: <span id="scoreNum">0</span></div>
  </div>

  <!-- Statement (top) -->
  <div class="block">
    <div class="blockTitle">ğŸŸ¦ Statement <span class="chip">çœ‹å¥å‹</span></div>
    <div class="sentence" id="statementRow"></div>
  </div>

  <!-- Word Bank (middle messy) -->
  <div class="block">
    <div class="blockTitle">ğŸ§© Word Bank <span class="chip">äº‚ç‘ï¼ˆè¦æ€è€ƒï¼‰</span></div>
    <div class="bankArea" id="bankArea"></div>
    <div class="toast" id="toast"></div>
  </div>

  <!-- Answer (bottom sticky) -->
  <div class="block answerSticky">
    <div class="blockTitle">â“ Make the Question <span class="chip">æ‹–åˆ°ä¸‹é¢ï¼ˆæœ€çœåŠ›ï¼‰</span></div>
    <div class="sentence" id="questionRow"></div>
  </div>
</div>

<script>
(() => {
  // ====== ä½ æŒ‡å®šçš„ 5 é¡Œï¼ˆå®Œå…¨å›ºå®šï¼‰ ======
  const ITEMS = [
    { statement:["it","is","an","ant","."],      answerQ:["is","it","an","ant","?"],      speak:"Is it an ant?" },
    { statement:["you","are","Abby","."],       answerQ:["are","you","Abby","?"],        speak:"Are you Abby?" },
    { statement:["he","is","Nick","."],        answerQ:["is","he","Nick","?"],          speak:"Is he Nick?" },
    { statement:["she","is","Fifi","."],       answerQ:["is","she","Fifi","?"],         speak:"Is she Fifi?" },
    { statement:["this","is","a","star","."],  answerQ:["is","this","a","star","?"],    speak:"Is this a star?" },
  ];

  const COLORS = ["mint","pink","lav","sky","lemon"];

  const statementRow = document.getElementById("statementRow");
  const questionRow  = document.getElementById("questionRow");
  const bankArea     = document.getElementById("bankArea");
  const toast        = document.getElementById("toast");

  const itemNum      = document.getElementById("itemNum");
  const scoreNum     = document.getElementById("scoreNum");

  const startBtn  = document.getElementById("startBtn");
  const repeatBtn = document.getElementById("repeatBtn");
  const resetBtn  = document.getElementById("resetBtn");

  let enabledAudio = false;
  let selectedTileId = null;

  let idx = 0;
  let score = 0;

  // ---------- helpers ----------
  const shuffle = (arr) => {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  };

  function setToast(msg){ toast.textContent = msg || ""; }

  function speak(text){
    if (!enabledAudio) return;
    try{
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "en-US";
      u.rate = 0.9;
      u.pitch = 1.05;
      window.speechSynthesis.speak(u);
    }catch(e){}
  }

  function cheer(){
    if (!enabledAudio) return;
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    if (!AudioCtx) return;
    const ctx = new AudioCtx();
    const now = ctx.currentTime;
    const freqs = [523.25, 659.25, 783.99];
    freqs.forEach((f, i) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type="sine";
      osc.frequency.setValueAtTime(f, now);
      gain.gain.setValueAtTime(0.0001, now);
      gain.gain.exponentialRampToValueAtTime(0.22, now + 0.02);
      gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.33 + i*0.03);
      osc.connect(gain).connect(ctx.destination);
      osc.start(now);
      osc.stop(now + 0.42 + i*0.03);
    });
    setTimeout(() => ctx.close().catch(()=>{}), 700);
  }

  function clearEl(el){ el.innerHTML = ""; }

  // ---------- tiles/slots ----------
  function makeStaticTile(text, color){
    const t = document.createElement("div");
    t.className = "tile";
    t.style.cursor = "default";
    t.dataset.color = color;
    t.innerHTML = `<span class="tileText">${text}</span>`;
    return t;
  }

  function makeTile(text, color){
    const t = document.createElement("div");
    t.className = "tile";
    t.dataset.text = text;
    t.dataset.color = color;

    const id = "tile_" + Math.random().toString(16).slice(2);
    t.id = id;
    t.setAttribute("draggable","true");

    t.addEventListener("dragstart", (e) => {
      selectedTileId = id;
      e.dataTransfer.setData("text/plain", id);
    });

    // tap-select fallback (mobile)
    t.addEventListener("click", () => {
      selectedTileId = id;
      setToast(`ğŸ‘‰ å·²é¸ï¼š${text}ï¼ˆé»ä¸‹é¢ç©ºæ ¼æ”¾å…¥ï¼‰`);
    });

    t.innerHTML = `<span class="tileText">${text}</span>`;
    return t;
  }

  function makeSlot(i, isPunct){
    const s = document.createElement("div");
    s.className = "slot" + (isPunct ? " punct" : "");
    s.dataset.slotIndex = String(i);

    s.addEventListener("dragover", (e)=> e.preventDefault());
    s.addEventListener("drop", (e)=>{
      e.preventDefault();
      const tileId = e.dataTransfer.getData("text/plain");
      if (tileId) placeTile(tileId, s);
    });

    // tap-to-place
    s.addEventListener("click", ()=>{
      if (selectedTileId) placeTile(selectedTileId, s);
    });

    return s;
  }

  // ---------- classroom-safe placement rules (but NO category hints) ----------
  function placeTile(tileId, slotEl){
    const tile = document.getElementById(tileId);
    if (!tile) return;

    const text = tile.dataset.text;
    const slotIndex = Number(slotEl.dataset.slotIndex);
    const slots = questionRow.querySelectorAll(".slot");
    const lastIndex = slots.length - 1;

    // ? only last slot
    if (text === "?" && slotIndex !== lastIndex){
      setToast("ğŸ‘‰ å•è™Ÿä¸€å®šè¦æ”¾æœ€å¾Œå–”ï¼");
      bankArea.appendChild(tile);
      randomScatter(); // å›å»ä¹Ÿäº‚ç‘
      return;
    }
    // last slot only ?
    if (slotIndex === lastIndex && text !== "?"){
      setToast("ğŸ‘‰ æœ€å¾Œä¸€æ ¼æ˜¯ ? çš„ä½ç½®å–”ï¼");
      bankArea.appendChild(tile);
      randomScatter();
      return;
    }

    // first slot only is/are (è®“è¦å‰‡ç©©ï¼Œä½†ä¸æç¤ºåè©/ä¸»è©)
    if (slotIndex === 0 && !(text === "is" || text === "are")){
      setToast("ğŸ‘‰ ç¬¬ä¸€æ ¼è¦æ”¾ is / are");
      bankArea.appendChild(tile);
      randomScatter();
      return;
    }

    // is/are must be early (0 or 1)
    if ((text === "is" || text === "are") && slotIndex > 1){
      setToast("ğŸ‘‰ is / are è¦æ”¾å‰é¢ï¼");
      bankArea.appendChild(tile);
      randomScatter();
      return;
    }

    // swap existing tile back to bank
    const existing = slotEl.querySelector(".tile");
    if (existing){
      bankArea.appendChild(existing);
    }

    // IMPORTANT: when tile is moved out of bankArea, remove absolute positioning
    tile.style.left = "";
    tile.style.top = "";
    tile.style.transform = "";

    slotEl.appendChild(tile);
    selectedTileId = null;

    checkAnswer();
  }

  // ---------- layout: messy scatter ----------
  function randomScatter(){
    // åªå° bankArea è£¡é¢çš„ tile äº‚ç‘
    const tiles = [...bankArea.querySelectorAll(".tile")];
    const rect = bankArea.getBoundingClientRect();

    // leave padding
    const pad = 12;
    const W = Math.max(200, rect.width) - pad*2;
    const H = Math.max(160, rect.height) - pad*2;

    tiles.forEach((t, i) => {
      // random position
      const x = pad + Math.random() * (W - 160);
      const y = pad + Math.random() * (H - 70);

      // random slight rotation for "messy" feel
      const r = (Math.random()*10 - 5);

      t.style.left = x + "px";
      t.style.top = y + "px";
      t.style.transform = `rotate(${r}deg)`;
    });
  }

  // ---------- check answer ----------
  function currentTokens(){
    return [...questionRow.querySelectorAll(".slot")].map(s=>{
      const t = s.querySelector(".tile");
      return t ? t.dataset.text : null;
    });
  }

  function checkAnswer(){
    const item = ITEMS[idx];
    const tokens = currentTokens();

    if (tokens.some(x => x === null)){
      questionRow.classList.remove("okGlow","warnGlow");
      return;
    }

    const ok = tokens.every((t, i) => t === item.answerQ[i]);

    if (ok){
      questionRow.classList.add("okGlow");
      questionRow.classList.remove("warnGlow");

      score += 10;
      scoreNum.textContent = String(score);

      setToast("âœ… Correct! Great job!");
      cheer();
      speak(item.speak);

      setTimeout(() => {
        nextItem();
      }, 900);
    } else {
      questionRow.classList.add("warnGlow");
      questionRow.classList.remove("okGlow");
      setToast("âŒ Not yet. æƒ³æƒ³ï¼šis/are åœ¨æœ€å‰é¢ï¼Œ? åœ¨æœ€å¾Œ");
    }
  }

  // ---------- render item ----------
  function renderItem(){
    const item = ITEMS[idx];
    itemNum.textContent = String(idx+1);
    scoreNum.textContent = String(score);

    // statement
    clearEl(statementRow);
    item.statement.forEach((w, i) => {
      const box = document.createElement("div");
      box.className = "slot" + (w === "." ? " punct" : "");
      box.appendChild(makeStaticTile(w, COLORS[i % COLORS.length]));
      statementRow.appendChild(box);
    });

    // question slots
    clearEl(questionRow);
    item.answerQ.forEach((tok, i) => {
      questionRow.appendChild(makeSlot(i, tok === "?"));
    });
    questionRow.classList.remove("okGlow","warnGlow");

    // bank tiles (shuffled, then scattered)
    clearEl(bankArea);
    const shuffled = shuffle(item.answerQ);
    shuffled.forEach((w, i) => {
      const tile = makeTile(w, COLORS[i % COLORS.length]);
      bankArea.appendChild(tile);
    });

    // scatter after paint
    setToast("æŠŠå­—å¡æ‹–åˆ°ä¸‹é¢åšç–‘å•å¥ï¼ˆè¨˜å¾—æ”¾ ?ï¼‰");
    requestAnimationFrame(randomScatter);
  }

  function nextItem(){
    idx = (idx + 1) % ITEMS.length;
    renderItem();
  }

  function restart(){
    idx = 0;
    score = 0;
    renderItem();
  }

  // ---------- buttons ----------
  startBtn.addEventListener("click", ()=>{
    enabledAudio = true;
    startBtn.disabled = true;
    repeatBtn.disabled = false;
    setToast("âœ… Voice enabled. Let's start!");
    speak("Let's start!");
    renderItem();
  });

  repeatBtn.addEventListener("click", ()=>{
    if (!enabledAudio) return;
    speak(ITEMS[idx].speak);
  });

  resetBtn.addEventListener("click", ()=>{
    restart();
  });

  // init without audio
  renderItem();
})();
</script>
</body>
</html>
