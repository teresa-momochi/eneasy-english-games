<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spelling Game - Fixed UI Edition (TJ4-U17)</title>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body, html {
      width: 100%; height: 100%;
      overflow: hidden;
      background: #000;
      font-family: Arial, "Microsoft JhengHei", sans-serif;
    }

    /* =========================================================
       ğŸŸ©ã€èƒŒæ™¯ã€‘ä½ çš„ pages å…§æª”åï¼šbg.png
       âœ… åŸæœ¬ images/pages/bg.png â†’ æ”¹æˆ pages/bg.png
    ========================================================== */
    #game-stage{
      position:absolute;
      top:50%; left:50%;
      width:100vw; height:56.25vw;
      max-height:100vh; max-width:177.78vh;
      transform:translate(-50%,-50%);
      background-image:url('pages/bg.png');
      background-size:cover;
      background-position:center;
    }

    /* å·¥å…·åˆ—ï¼ˆå³ä¸Šï¼‰ */
    .toolbar{
      position:absolute; top:3%; right:2%;
      display:flex; gap:15px; z-index:100;
      align-items:center;
    }
    .tool-btn{ width:5.5vw; height:5.5vw; cursor:pointer; position:relative; }
    #mute-overlay{
      position:absolute; top:0; left:0; width:100%; height:100%;
      display:none; pointer-events:none;
    }

    /* =========================================================
       ğŸŸ¦ã€å­—æ¯å€ã€‘å·¦å´å­—æ¯è²¼ç´™
    ========================================================== */
    #keyboard-area{ position:absolute; top:12%; left:3%; width:40%; height:65%; }
    .letter-sticker{
      position:absolute;
      width:18%;
      cursor:pointer;
      transition:transform .1s;
      z-index:10;
    }
    .letter-sticker:active{ transform:scale(.9); }

    /* =========================================================
       ğŸŸ©ã€ç­”æ¡ˆæ¡†ã€‘ä½ è³‡æ–™å¤¾æ²’æœ‰ display_box.png
       âœ… æ”¹æˆç´”è‰²é•·æ¢ï¼Œè¦–è¦ºæ¥è¿‘ä½ å³åœ–çš„é»ƒè‰²æ¡†
    ========================================================== */
    #answer-display{
      position:absolute; top:12%; left:45%;
      width:50%; height:12%;
      background: rgba(255, 233, 150, 0.85);
      border-radius: 1.2vw;
      display:flex; align-items:center; justify-content:center;
      font-size:3vw; color:#333;
      letter-spacing:.5vw; font-weight:800;
    }

    /* =========================================================
       ğŸŸ©ã€å¡ç‰‡ï¼ˆæ•¸å­—çƒï¼‰ã€‘card-item
       âœ… ç”± 4 å¼µ â†’ æ”¹æˆ 8 å¼µï¼ˆ13~20ï¼‰
    ========================================================== */
    .card-item{
      position:absolute;
      width:14%;
      transition:all .3s;
      z-index:5;
    }
    .target-active{
      filter: drop-shadow(0 0 15px gold);
      animation: breathe 1.5s infinite ease-in-out;
      z-index:20;
    }
    .target-inactive{ opacity:.55; filter: grayscale(20%); }
    @keyframes breathe{
      0%,100%{ transform:scale(1); filter: drop-shadow(0 0 10px gold); }
      50%{ transform:scale(1.06); filter: drop-shadow(0 0 26px gold); }
    }

    /* å·¦ä¸‹æŒ‰éˆ• */
    #btn-cancel{ position:absolute; bottom:5%; left:2%; width:18%; cursor:pointer; z-index:30; }
    #btn-enter{  position:absolute; bottom:5%; left:22%; width:18%; cursor:pointer; z-index:30; }

    /* éŒ¯èª¤å±¤ */
    #wrong-layer{
      position:absolute; inset:0;
      background: rgba(0,0,0,0.10);
      display:none;
      justify-content:center; align-items:center;
      z-index:999;
    }
    #wrong-img{ width:45%; }

    /* =========================================================
       ğŸŸ©ã€è¦å‰‡é ã€‘ä½ çš„ pages å…§æª”åï¼šrule_spelling_game_16x9.png
       âœ… åŸæœ¬ images/pages/... â†’ æ”¹æˆ pages/...
    ========================================================== */
    #rule-screen{
      position:absolute; inset:0;
      background-image:url('pages/rule_spelling_game_16x9.png');
      background-size:100% 100%;
      z-index:2000;
      display:flex;
      justify-content:center;
      align-items:flex-end;
    }
    #start-btn{ width:15%; margin-bottom:5%; cursor:pointer; }
  </style>
</head>

<body>
<div id="game-stage">

  <div class="toolbar">
    <!-- ğŸŸ©ã€UIã€‘ä½ çš„è³‡æ–™å¤¾ï¼šui/exit.png ui/rule.png ui/bgmusic.png -->
    <img src="ui/exit.png" class="tool-btn" onclick="window.close()">
    <img src="ui/rule.png" class="tool-btn" onclick="toggleRule(true)">

    <div class="tool-btn" onclick="toggleMusic()">
      <img src="ui/bgmusic.png" style="width:100%">
      <svg id="mute-overlay" viewBox="0 0 100 100">
        <line x1="10" y1="10" x2="90" y2="90" stroke="red" stroke-width="8"/>
      </svg>
    </div>
  </div>

  <div id="keyboard-area"></div>
  <div id="answer-display"></div>

  <!-- =========================================================
       ğŸŸ©ã€å¡ç‰‡ä½ç½®ã€‘8 å¼µï¼ˆä½ å¯ä¾å³åœ–å†å¾®èª¿ top/leftï¼‰
       é€™è£¡æˆ‘å…ˆæ’æˆã€Œå³ä¸‹ç¾¤çµ„ã€çš„è¦–è¦º
  ========================================================== -->
  <img id="card-0" class="card-item" style="top:46%; left:52%;">
  <img id="card-1" class="card-item" style="top:46%; left:66%;">
  <img id="card-2" class="card-item" style="top:46%; left:80%;">

  <img id="card-3" class="card-item" style="top:63%; left:48%;">
  <img id="card-4" class="card-item" style="top:63%; left:62%;">
  <img id="card-5" class="card-item" style="top:63%; left:76%;">
  <img id="card-6" class="card-item" style="top:63%; left:90%;">

  <img id="card-7" class="card-item" style="top:71%; left:56%; width:16%;"> <!-- 20 ä½ å³åœ–æ¯”è¼ƒå¤§ -->

  <!-- ğŸŸ©ã€æŒ‰éˆ•ã€‘ui/cancel.png ui/enter.png -->
  <img src="ui/cancel.png" id="btn-cancel" onclick="handleCancel()">
  <img src="ui/enter.png" id="btn-enter" onclick="handleEnter()">

  <!-- ğŸŸ¥ã€éŒ¯èª¤åœ–ã€‘ui/wrong.png -->
  <div id="wrong-layer" onclick="resetAfterError()">
    <img src="ui/wrong.png" id="wrong-img">
  </div>

  <!-- ğŸŸ©ã€è¦å‰‡é é–‹å§‹ã€‘ä½ æœ‰ ui/start.pngï¼ˆä¸æ˜¯ images/ui/start.pngï¼‰ -->
  <div id="rule-screen">
    <img src="ui/start.png" id="start-btn" onclick="toggleRule(false)">
  </div>
</div>

<!-- =========================================================
     ğŸŸªã€éŸ³æ•ˆã€‘ä½ çš„ sounds è³‡æ–™å¤¾ï¼šbgmusic.mp3 / hurray.mp3 / wrong.mp3
========================================================== -->
<audio id="audio-bg" src="sounds/bgmusic.mp3" loop></audio>
<audio id="audio-wrong" src="sounds/wrong.mp3"></audio>
<audio id="audio-hurray" src="sounds/hurray.mp3"></audio>

<script>
  /* =========================================================
     ğŸŸ¨ã€targetsã€‘ä¾ç…§ cards è³‡æ–™å¤¾æª”å 13~20ï¼ˆ8 å¼µï¼‰
     cards/ å…§æª”åï¼š
     thirteen.png fourteen.png fifteen.png sixteen.png
     seventeen.png eighteen.png nineteen.png twenty.png
  ========================================================== */
  const GAME_CONFIG = {
    targets: [
      { word:"thirteen",  display:"thirteen",  img:"thirteen.png" },
      { word:"fourteen",  display:"fourteen",  img:"fourteen.png" },
      { word:"fifteen",   display:"fifteen",   img:"fifteen.png" },
      { word:"sixteen",   display:"sixteen",   img:"sixteen.png" },
      { word:"seventeen", display:"seventeen", img:"seventeen.png" },
      { word:"eighteen",  display:"eighteen",  img:"eighteen.png" },
      { word:"nineteen",  display:"nineteen",  img:"nineteen.png" },
      { word:"twenty",    display:"twenty",    img:"twenty.png" }
    ],

    /* =========================================================
       ğŸŸ¦ã€lettersã€‘ä¾ç…§ä½  letters è³‡æ–™å¤¾ 15 å€‹æª”åï¼š
       e f g h i n o r s t u v w x y
       æˆ‘ç”¨ä½ åŸæœ¬ 4x4 ä½ç½®ï¼Œæœ€å¾Œä¸€æ ¼ç•™ç©º
    ========================================================== */
    letterLayout: [
      { char:'e', t:0,  l:0  }, { char:'f', t:0,  l:25 }, { char:'g', t:0,  l:50 }, { char:'h', t:0,  l:75 },
      { char:'i', t:25, l:0  }, { char:'n', t:25, l:25 }, { char:'o', t:25, l:50 }, { char:'r', t:25, l:75 },
      { char:'s', t:50, l:0  }, { char:'t', t:50, l:25 }, { char:'u', t:50, l:50 }, { char:'v', t:50, l:75 },
      { char:'w', t:75, l:0  }, { char:'x', t:75, l:25 }, { char:'y', t:75, l:50 }
      // { char:'(empty)', t:75, l:75 }  â† æ•…æ„ç•™ç©ºï¼Œé¿å…æ‰¾ä¸åˆ°åœ–æª”
    ]
  };

  let currentIndex = 0;
  let currentInput = "";
  let isMuted = false;
  let isErrorActive = false;
  let isPaused = true;

  /* ğŸŸ¦ å»ºç«‹å­—æ¯éµç›¤ */
  function initKeyboard(){
    const container = document.getElementById('keyboard-area');
    container.innerHTML = "";
    GAME_CONFIG.letterLayout.forEach(item=>{
      const img = new Image();
      img.src = `letters/${item.char}.png`;  // âœ… images/letters â†’ letters
      img.className = 'letter-sticker';
      img.style.top = item.t + '%';
      img.style.left = item.l + '%';
      img.onclick = ()=> typeLetter(item.char);
      img.onerror = ()=> img.remove();
      container.appendChild(img);
    });
  }

  /* ğŸŸ© æ›´æ–°å¡ç‰‡åœ–èˆ‡é«˜äº® */
  function refreshStage(){
    GAME_CONFIG.targets.forEach((item, idx)=>{
      const el = document.getElementById(`card-${idx}`);
      if(!el) return;
      el.src = `cards/${item.img}`; // âœ… images/cards â†’ cards
      el.className = `card-item ${idx===currentIndex ? 'target-active' : 'target-inactive'}`;
    });
    updateDisplayText();
  }

  /* ğŸŸ¨ ç­”æ¡ˆé¡¯ç¤ºï¼ˆåº•ç·šï¼‰ */
  function updateDisplayText(){
    const target = GAME_CONFIG.targets[currentIndex];
    const template = target.display;
    let resultHtml = "";
    let inputPointer = 0;

    for(const ch of template){
      if(ch === " "){
        resultHtml += "&nbsp;";
      }else{
        if(inputPointer < currentInput.length){
          resultHtml += currentInput[inputPointer].toLowerCase();
          inputPointer++;
        }else{
          resultHtml += "_";
        }
      }
    }
    document.getElementById('answer-display').innerHTML = resultHtml;
  }

  function typeLetter(char){
    if(isPaused || isErrorActive){
      if(isErrorActive) resetAfterError();
      return;
    }
    const limit = GAME_CONFIG.targets[currentIndex].word.length;
    if(currentInput.length < limit){
      currentInput += char;
      updateDisplayText();
    }else{
      showError();
    }
  }

  function handleEnter(){
    if(isPaused || isErrorActive) return;
    const target = GAME_CONFIG.targets[currentIndex].word;
    if(currentInput === "" || currentInput.toLowerCase() !== target.toLowerCase()){
      showError();
    }else{
      showSuccess();
    }
  }

  function handleCancel(){
    if(isPaused || isErrorActive) return;
    currentInput = "";
    updateDisplayText();
  }

  /* ğŸŸ¥éŒ¯èª¤ï¼šé¡¯ç¤º poop åœ– + æ’­ wrong */
  function showError(){
    isErrorActive = true;
    document.getElementById('audio-bg').pause();
    document.getElementById('audio-wrong').play();
    document.getElementById('wrong-layer').style.display = 'flex';
  }

  function resetAfterError(){
    isErrorActive = false;
    document.getElementById('wrong-layer').style.display = 'none';
    currentInput = "";
    updateDisplayText();
    if(!isMuted) document.getElementById('audio-bg').play();
  }

  /* âœ…æˆåŠŸï¼šæ’­ hurray â†’ æ›ä¸‹ä¸€å€‹ç›®æ¨™ */
  function showSuccess(){
    isPaused = true;
    document.getElementById('audio-bg').pause();
    document.getElementById('audio-hurray').play();

    const activeCard = document.querySelector('.target-active');
    if(activeCard){
      activeCard.style.outline = "8px solid #00FF00";
      activeCard.style.outlineOffset = "5px";
    }

    setTimeout(()=>{
      if(activeCard) activeCard.style.outline = "none";
      currentIndex++;
      if(currentIndex >= GAME_CONFIG.targets.length) currentIndex = 0;
      currentInput = "";
      isPaused = false;
      refreshStage();
      if(!isMuted) document.getElementById('audio-bg').play();
    }, 2500);
  }

  function toggleRule(show){
    isPaused = show;
    document.getElementById('rule-screen').style.display = show ? 'flex' : 'none';
    if(show) document.getElementById('audio-bg').pause();
    else if(!isMuted) document.getElementById('audio-bg').play();
  }

  function toggleMusic(){
    isMuted = !isMuted;
    const bg = document.getElementById('audio-bg');
    document.getElementById('mute-overlay').style.display = isMuted ? 'block' : 'none';
    if(isMuted) bg.pause();
    else if(!isPaused) bg.play();
  }

  window.onload = ()=>{
    initKeyboard();
    refreshStage();
  };
</script>
</body>
</html>
